<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ƒêƒÉng Nh·∫≠p & ƒêƒÉng K√Ω - NMT VIP BO</title>
    <style>
        :root {
            --bg-panel: #1e2329;
            --bg-base: #0b0e11;
            --border: #2b3139;
            --accent: #fcd535;
            --text-muted: #848e9c;
            --red: #f6465d;
            --green: #0ecb81;
        }
        
        /* T·ªëi ∆∞u cho m√†n h√¨nh Mobile */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 15px; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: radial-gradient(circle at center, #181a20 0%, #0b0e11 100%);
            color: white;
            box-sizing: border-box;
        }
        .login-box {
            background: var(--bg-panel);
            padding: 30px 20px; 
            border-radius: 12px;
            border: 1px solid var(--border);
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
            text-align: center;
            box-sizing: border-box;
        }
        .login-box h2 { color: var(--accent); margin-top: 0; margin-bottom: 20px; font-size: 22px; }
        .input-group { text-align: left; margin-bottom: 15px; }
        .input-group label { display: block; font-size: 13px; color: var(--text-muted); margin-bottom: 6px; }
        .input-group input {
            width: 100%; 
            background: var(--bg-base); 
            border: 1px solid var(--border);
            color: white; 
            padding: 14px; /* K√≠ch th∆∞·ªõc t·ªëi ∆∞u ƒë·ªÉ ch·∫°m ng√≥n tay */
            border-radius: 8px; 
            outline: none; 
            box-sizing: border-box;
            font-size: 15px;
        }
        .input-group input:focus { border-color: var(--accent); }
        .error-msg { color: var(--red); font-size: 13px; margin-bottom: 15px; display: none; }
        .success-msg { color: var(--green); font-size: 13px; margin-bottom: 15px; display: none; }
        .toggle-form { margin-top: 20px; font-size: 14px; color: var(--text-muted); cursor: pointer; text-decoration: underline; padding: 10px 0;}
        .toggle-form:hover { color: var(--accent); }
        .btn-buy { 
            background: var(--accent); color: black; border: none; 
            padding: 15px; font-weight: bold; font-size: 16px; 
            border-radius: 8px; cursor: pointer; width: 100%; margin-top: 10px;
        }
        .btn-buy:disabled { opacity: 0.6; cursor: not-allowed; }
    </style>
</head>
<body>

    <div class="login-box" id="login-form">
        <h2>üíé ƒêƒÇNG NH·∫¨P</h2>
        <div class="input-group">
            <label>ID Ng∆∞·ªùi Ch∆°i</label>
            <input type="text" id="login-id" placeholder="Nh·∫≠p ID...">
        </div>
        <div class="input-group">
            <label>M·∫≠t kh·∫©u</label>
            <input type="password" id="login-pass" placeholder="Nh·∫≠p m·∫≠t kh·∫©u...">
        </div>
        <div id="login-error" class="error-msg"></div>
        <button id="btn-login" class="btn-buy" onclick="doLogin()">ƒêƒÉng Nh·∫≠p</button>
        <div style="display: flex; justify-content: space-between; margin-top: 15px;">
            <span class="toggle-form" onclick="switchForm('register')">T·∫°o t√†i kho·∫£n</span>
            <span class="toggle-form" onclick="switchForm('forgot')">Qu√™n m·∫≠t kh·∫©u?</span>
        </div>
    </div>

    <div class="login-box" id="register-form" style="display: none;">
        <h2>üìù ƒêƒÇNG K√ù</h2>
        <div class="input-group">
            <label>T·∫°o ID M·ªõi</label>
            <input type="text" id="reg-id" placeholder="VD: nmt2026">
        </div>
        <div class="input-group">
            <label>M·∫≠t kh·∫©u</label>
            <input type="password" id="reg-pass" placeholder="T·ªëi thi·ªÉu 6 k√Ω t·ª±">
        </div>
        <div class="input-group">
            <label>M√£ b√≠ m·∫≠t (D√πng ƒë·ªÉ kh√¥i ph·ª•c MK)</label>
            <input type="text" id="reg-recovery" placeholder="VD: conmeo">
        </div>
        <div id="reg-error" class="error-msg"></div>
        <div id="reg-success" class="success-msg">ƒêƒÉng k√Ω th√†nh c√¥ng! ƒêang chuy·ªÉn v·ªÅ ƒëƒÉng nh·∫≠p...</div>
        <button id="btn-register" class="btn-buy" onclick="doRegister()">X√°c Nh·∫≠n ƒêƒÉng K√Ω</button>
        <div class="toggle-form" onclick="switchForm('login')">Quay l·∫°i ƒëƒÉng nh·∫≠p</div>
    </div>

    <div class="login-box" id="forgot-form" style="display: none;">
        <h2>üîê L·∫§Y L·∫†I M·∫¨T KH·∫®U</h2>
        <div class="input-group">
            <label>ID c·ªßa b·∫°n</label>
            <input type="text" id="fg-id" placeholder="Nh·∫≠p ID...">
        </div>
        <div class="input-group">
            <label>M√£ b√≠ m·∫≠t l√∫c ƒëƒÉng k√Ω</label>
            <input type="text" id="fg-recovery" placeholder="Nh·∫≠p m√£ b√≠ m·∫≠t...">
        </div>
        <div class="input-group">
            <label>M·∫≠t kh·∫©u m·ªõi</label>
            <input type="password" id="fg-newpass" placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi">
        </div>
        <div id="fg-error" class="error-msg"></div>
        <div id="fg-success" class="success-msg">ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!</div>
        <button id="btn-forgot" class="btn-buy" onclick="doForgot()">C·∫•p L·∫°i M·∫≠t Kh·∫©u</button>
        <div class="toggle-form" onclick="switchForm('login')">Quay l·∫°i ƒëƒÉng nh·∫≠p</div>
    </div>

    <script>
        // === B·∫†N PH·∫¢I THAY LINK SCRIPT M·ªöI C·ª¶A B·∫†N V√ÄO ƒê√ÇY ===
        const GS_URL = "https://script.google.com/macros/s/AKfycbypWHtNHG5Svb6GkaAddQzwtxdShbJkPN_IYLKQEDJjgN71LAI-_6plLg-RJTsLEgsDpw/exec"; 

        // H√†m bƒÉm m·∫≠t kh·∫©u (SHA-256) x·ª≠ l√Ω tr√™n RAM, kh√¥ng l∆∞u xu·ªëng ·ªï c·ª©ng
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // Chuy·ªÉn ƒë·ªïi qua l·∫°i gi·ªØa c√°c Form
        function switchForm(type) {
            document.getElementById('login-form').style.display = type === 'login' ? 'block' : 'none';
            document.getElementById('register-form').style.display = type === 'register' ? 'block' : 'none';
            document.getElementById('forgot-form').style.display = type === 'forgot' ? 'block' : 'none';
            document.querySelectorAll('.error-msg, .success-msg').forEach(el => el.style.display = 'none');
        }

        // G·ª≠i d·ªØ li·ªáu l√™n Google Sheets
        async function sendToSheet(payload) {
            try {
                const response = await fetch(GS_URL, {
                    method: "POST",
                    headers: { "Content-Type": "text/plain;charset=utf-8" },
                    body: JSON.stringify(payload)
                });
                return await response.json();
            } catch (error) {
                return { status: "error", message: "Kh√¥ng th·ªÉ k·∫øt n·ªëi m√°y ch·ªß!" };
            }
        }

        // ------------------------------------
        // CH·ª®C NƒÇNG ƒêƒÇNG K√ù
        // ------------------------------------
        async function doRegister() {
            const id = document.getElementById('reg-id').value.trim();
            const pass = document.getElementById('reg-pass').value.trim();
            const recovery = document.getElementById('reg-recovery').value.trim();
            const errBox = document.getElementById('reg-error');
            const btn = document.getElementById('btn-register');

            errBox.style.display = 'none';
            if (!id || !pass || !recovery) return showErr(errBox, "Vui l√≤ng ƒëi·ªÅn ƒë·ªß th√¥ng tin!");
            if (pass.length < 6) return showErr(errBox, "M·∫≠t kh·∫©u t·ªëi thi·ªÉu 6 k√Ω t·ª±!");

            btn.innerText = "ƒêang x·ª≠ l√Ω..."; btn.disabled = true;
            const hashedPass = await sha256(pass);
            
            const result = await sendToSheet({ action: "REGISTER", id: id, pass: hashedPass, recovery: recovery });

            btn.innerText = "X√°c Nh·∫≠n ƒêƒÉng K√Ω"; btn.disabled = false;
            if (result.status === "success") {
                document.getElementById('reg-success').style.display = 'block';
                // ƒêƒÉng k√Ω xong t·ª± quay v·ªÅ form ƒêƒÉng Nh·∫≠p
                setTimeout(() => switchForm('login'), 1500); 
            } else {
                showErr(errBox, result.message);
            }
        }

        // ------------------------------------
        // CH·ª®C NƒÇNG ƒêƒÇNG NH·∫¨P
        // ------------------------------------
        async function doLogin() {
            const id = document.getElementById('login-id').value.trim();
            const pass = document.getElementById('login-pass').value.trim();
            const errBox = document.getElementById('login-error');
            const btn = document.getElementById('btn-login');

            errBox.style.display = 'none';
            if (!id || !pass) return showErr(errBox, "ƒêi·ªÅn ID v√† m·∫≠t kh·∫©u!");

            btn.innerText = "ƒêang ki·ªÉm tra..."; btn.disabled = true;
            const hashedPass = await sha256(pass);
            
            const result = await sendToSheet({ action: "LOGIN", id: id, pass: hashedPass });

            btn.innerText = "ƒêƒÉng Nh·∫≠p"; btn.disabled = false;
            if (result.status === "success") {
                // ƒêƒÉng nh·∫≠p th√†nh c√¥ng -> Chuy·ªÉn trang v√† nh√∫ng ID l√™n link
                // V√≠ d·ª•: index.html?id=nmt2026
                window.location.href = `index.html?id=${encodeURIComponent(id)}`; 
            } else {
                showErr(errBox, result.message);
            }
        }

        // ------------------------------------
        // CH·ª®C NƒÇNG QU√äN M·∫¨T KH·∫®U
        // ------------------------------------
        async function doForgot() {
            const id = document.getElementById('fg-id').value.trim();
            const recovery = document.getElementById('fg-recovery').value.trim();
            const newpass = document.getElementById('fg-newpass').value.trim();
            const errBox = document.getElementById('fg-error');
            const btn = document.getElementById('btn-forgot');

            errBox.style.display = 'none';
            if (!id || !recovery || !newpass) return showErr(errBox, "ƒêi·ªÅn ƒë·ªß th√¥ng tin!");

            btn.innerText = "ƒêang x·ª≠ l√Ω..."; btn.disabled = true;
            const hashedNewPass = await sha256(newpass);
            
            const result = await sendToSheet({ action: "RESET_PASS", id: id, recovery: recovery, newPass: hashedNewPass });

            btn.innerText = "C·∫•p L·∫°i M·∫≠t Kh·∫©u"; btn.disabled = false;
            if (result.status === "success") {
                document.getElementById('fg-success').style.display = 'block';
                setTimeout(() => switchForm('login'), 1500);
            } else {
                showErr(errBox, result.message);
            }
        }

        // Hi·ªÉn th·ªã l·ªói
        function showErr(element, text) {
            element.innerText = text;
            element.style.display = 'block';
        }
    </script>
</body>
</html>
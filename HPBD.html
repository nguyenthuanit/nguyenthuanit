<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INITIALIZING BIRTHDAY PROTOCOL...</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;700&family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #00ffff; /* Cyan */
            --secondary-color: #6a5acd; /* Slate Blue */
            --background-start: #0f2027;
            --background-mid: #203a43;
            --background-end: #2c5364;
            --glitch-color-1: #ff00c1;
            --glitch-color-2: #00ff95;
        }

        body {
            margin: 0; padding: 0; font-family: 'Source Code Pro', monospace; overflow: hidden;
            background: linear-gradient(135deg, var(--background-start), var(--background-mid), var(--background-end));
            color: #e0e0e0; display: flex; justify-content: center; align-items: center; height: 100vh; cursor: pointer;
        }

        .scan-lines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 3px, 4px 100%;
            animation: scan 5s linear infinite; z-index: 0;
        }
        @keyframes scan { from { background-position: 0 0; } to { background-position: 0 100vh; } }

        #init-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.95); display: flex; justify-content: center; align-items: center;
            z-index: 1000; opacity: 1; transition: opacity 1.5s ease-in-out;
            color: #00ff00; font-family: 'Orbitron', sans-serif; text-shadow: 0 0 15px #00ff00;
        }
        #init-overlay.prompt-mode span {
            font-size: 2vw; animation: blinkCaret 1s step-end infinite;
        }
        #init-overlay.countdown-mode span {
            font-size: 18vw;
        }
        @keyframes blinkCaret { from, to { border-right: 3px solid #00ff00; } 50% { border-right-color: transparent; } }

        .birthday-card {
            display: none; position: relative; width: 90%; max-width: 800px; padding: 50px 40px;
            background-color: rgba(10, 25, 30, 0.85); border-radius: 15px; border: 1px solid var(--primary-color);
            box-shadow: 0 0 40px rgba(0, 255, 255, 0.5), 0 0 20px rgba(0, 200, 200, 0.7);
            text-align: center; animation: fadeInCard 1.8s ease-in-out forwards; z-index: 10;
        }

        .card-title {
            font-size: 5em; color: var(--primary-color); font-family: 'Orbitron', sans-serif;
            margin-bottom: 25px; position: relative; text-shadow: 0 0 15px var(--primary-color);
        }
        .card-title::before, .card-title::after {
            content: 'Happy Birthday!'; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: transparent; overflow: hidden;
        }
        .card-title::before { left: 2px; text-shadow: -2px 0 var(--glitch-color-1); animation: glitch-anim-1 2s infinite linear alternate-reverse; }
        .card-title::after { left: -2px; text-shadow: -2px 0 var(--glitch-color-2); animation: glitch-anim-2 2s infinite linear alternate-reverse; }
        @keyframes glitch-anim-1 { 0%, 100% { clip-path: inset(45% 0 50% 0); } 25% { clip-path: inset(10% 0 80% 0); } 50% { clip-path: inset(85% 0 5% 0); } 75% { clip-path: inset(60% 0 30% 0); } }
        @keyframes glitch-anim-2 { 0%, 100% { clip-path: inset(5% 0 90% 0); } 25% { clip-path: inset(70% 0 20% 0); } 50% { clip-path: inset(30% 0 65% 0); } 75% { clip-path: inset(95% 0 2% 0); } }

        .card-message {
            font-size: 1.6em; color: var(--secondary-color); line-height: 1.8;
            margin-bottom: 40px; font-weight: 700; text-shadow: 0 0 8px rgba(106, 90, 205, 0.7);
        }
        .typing-cursor { display: inline-block; width: 10px; height: 1.5em; background-color: var(--secondary-color); animation: blinkCursor 0.7s infinite; }
        @keyframes blinkCursor { 50% { opacity: 0; } }

        #code-rain-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; overflow: hidden; }
        .code-char { position: absolute; color: rgba(0, 255, 0, 0.8); font-size: 16px; opacity: 0; animation: codeFall linear infinite; }
        @keyframes codeFall { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(105vh); opacity: 0; } }
        @keyframes fadeInCard { from { transform: translateY(50px) scale(0.9); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }

        @media (max-width: 768px) { .card-title { font-size: 3em; } .card-message { font-size: 1.2em; } #init-overlay.prompt-mode span { font-size: 4vw; } #init-overlay.countdown-mode span { font-size: 25vw; } }
        @media (max-width: 480px) { .card-title { font-size: 2.2em; } .card-message { font-size: 1em; } #init-overlay.prompt-mode span { font-size: 6vw; } #init-overlay.countdown-mode span { font-size: 35vw; } }
    </style>
</head>
<body>
    <div class="scan-lines"></div>
    <div id="code-rain-container"></div>

    <div id="init-overlay" class="prompt-mode">
        <span id="init-text">[ PRESS ANY KEY TO INITIALIZE ]</span>
    </div>

    <div class="birthday-card" id="birthdayCard">
        <h1 class="card-title">Happy Birthday!</h1>
        <p class="card-message" id="typed-message"></p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const initOverlay = document.getElementById('init-overlay');
            const initText = document.getElementById('init-text');
            const birthdayCard = document.getElementById('birthdayCard');
            const typedMessage = document.getElementById('typed-message');
            const codeRainContainer = document.getElementById('code-rain-container');

            let initialized = false;
            let audioCtx;

            // ===== HÀM ĐÃ SỬA LỖI =====
            function playSound({ type = 'sine', frequency = 440, gain = 0.1, duration = 0.5, attack = 0.01 }) {
                if (!audioCtx) return;
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);

                oscillator.type = type;
                oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
                
                gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(gain, audioCtx.currentTime + attack);

                oscillator.start(audioCtx.currentTime);

                // Chỉ lên lịch dừng nếu duration > 0 để tránh lỗi
                if (duration > 0) {
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
                    oscillator.stop(audioCtx.currentTime + duration);
                }
            }

            const playInitialSound = () => playSound({ frequency: 440, gain: 0.2, duration: 0.5 });
            const playCountdownTick = () => playSound({ frequency: 880, gain: 0.15, duration: 0.2 });
            const playTypingSound = () => playSound({ type: 'square', frequency: 1500, gain: 0.05, duration: 0.05 });
            const startAmbience = () => playSound({ frequency: 50, gain: 0.05, duration: 0 }); // duration 0 = không dừng

            function initialize() {
                if (initialized) return;
                initialized = true;

                // Trả con trỏ chuột về mặc định
                document.body.style.cursor = 'default';

                audioCtx = new (window.AudioContext || window.webkitAudioContext)();

                playInitialSound();
                startAmbience();
                startCountdown();
            }
            
            window.addEventListener('keydown', initialize, { once: true });
            window.addEventListener('click', initialize, { once: true });

            function startCountdown() {
                let count = 3;
                
                initOverlay.classList.replace('prompt-mode', 'countdown-mode');
                initText.textContent = count;
                playCountdownTick();
                
                const countdownInterval = setInterval(() => {
                    count--;
                    if (count > 0) {
                        initText.textContent = count;
                        playCountdownTick();
                    } else {
                        clearInterval(countdownInterval);
                        // Thêm thông điệp cuối để chuyển tiếp mượt mà hơn
                        initOverlay.classList.replace('countdown-mode', 'prompt-mode');
                        initText.textContent = 'ACCESS GRANTED';
                        setTimeout(() => {
                            initOverlay.style.opacity = '0';
                            setTimeout(() => {
                                initOverlay.style.display = 'none';
                                birthdayCard.style.display = 'block';
                                createCodeRain();
                                typeWriter();
                            }, 1500);
                        }, 1000);
                    }
                }, 1000);
            }

            const speed = 60;
            const messageLines = ["Chúc mừng sinh nhật tôi", "Nguyễn Minh Thuận", "10/10/199x"];
            let lineIndex = 0, charIndex = 0;

            function typeWriter() {
                if (lineIndex < messageLines.length) {
                    if (charIndex < messageLines[lineIndex].length) {
                        typedMessage.innerHTML = typedMessage.innerHTML.replace('<span class="typing-cursor"></span>', '');
                        typedMessage.innerHTML += messageLines[lineIndex].charAt(charIndex);
                        typedMessage.innerHTML += '<span class="typing-cursor"></span>';
                        charIndex++;
                        if (messageLines[lineIndex].charAt(charIndex-1) !== ' ') playTypingSound();
                        setTimeout(typeWriter, speed);
                    } else {
                        typedMessage.innerHTML = typedMessage.innerHTML.replace('<span class="typing-cursor"></span>', '');
                        typedMessage.innerHTML += '<br>';
                        lineIndex++; charIndex = 0;
                        setTimeout(typeWriter, speed * 5);
                    }
                } else {
                    typedMessage.innerHTML = typedMessage.innerHTML.replace('<span class="typing-cursor"></span>', '');
                }
            }

            function createCodeRain() {
                const charSet = "01"; 
                const maxChars = 500;
                const fragment = document.createDocumentFragment();

                for (let i = 0; i < maxChars; i++) {
                    const char = document.createElement('span');
                    char.classList.add('code-char');
                    char.textContent = charSet[Math.floor(Math.random() * charSet.length)];
                    char.style.left = Math.random() * 100 + 'vw';
                    char.style.animationDuration = `${Math.random() * 8 + 5}s`;
                    char.style.animationDelay = `${Math.random() * 10}s`;
                    char.style.fontSize = `${Math.random() * 10 + 10}px`;
                    char.style.color = `rgba(0, ${Math.floor(Math.random() * 155) + 100}, 0, ${Math.random() * 0.5 + 0.3})`;
                    fragment.appendChild(char);
                }
                codeRainContainer.appendChild(fragment);
            }
        });
    </script>
</body>
</html>
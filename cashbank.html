<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng Gi·∫£ L·∫≠p Gateway & Tin Nh·∫Øn CHUY√äN NGHI·ªÜP</title>
    <link rel="stylesheet" href="css/cashbank.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>

    <div id="lock-screen">
        <div class="lock-card">
            <h2 class="lock-title">üîê Nh·∫≠p M√£ PIN B·∫£o M·∫≠t</h2>
            <p class="lock-hint">M√£ PIN m·∫∑c ƒë·ªãnh: **1239**</p>
            
            <div id="pin-display" class="pin-display">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </div>
            
            <div class="pin-buttons">
                <button onclick="enterPin(1)">1</button>
                <button onclick="enterPin(2)">2</button>
                <button onclick="enterPin(3)">3</button>
                <button onclick="enterPin(4)">4</button>
                <button onclick="enterPin(5)">5</button>
                <button onclick="enterPin(6)">6</button>
                <button onclick="enterPin(7)">7</button>
                <button onclick="enterPin(8)">8</button>
                <button onclick="enterPin(9)">9</button>
                <button class="delete-btn" onclick="deletePin()"><img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M21 4H8l-7 8 7 8h13a2 2 0 002-2V6a2 2 0 00-2-2zM11 9l4 4m0-4l-4 4'/></svg>" width="24" height="24"></button>
                <button onclick="enterPin(0)">0</button>
                <button class="enter-btn" onclick="checkPassword()">ENTER</button>
            </div>
        </div>
    </div>

    <div class="container" id="main-container" style="display: none;">
        
        <div class="config-panel">
            <h2>üè¶ Qu·∫£n L√Ω T√†i Kho·∫£n (Chuy√™n Nghi·ªáp)</h2>
            
            <div class="config-group">
                <label for="active-account-select">Ch·ªçn T√†i Kho·∫£n Hi·ªán T·∫°i</label>
                <select id="active-account-select" onchange="switchAccount()">
                    </select>
            </div>

            <div class="config-group">
                <label for="bank-select">Ng√¢n h√†ng Nh·∫≠n</label>
                <select id="bank-select">
                    <option value="VCB">Vietcombank</option>
                    <option value="TCB">Techcombank</option>
                    <option value="MB">MB Bank</option>
                </select>
            </div>

            <div class="config-group">
                <label for="new-account-name">T√™n G·ª£i Nh·ªõ (T·∫°o m·ªõi)</label>
                <input type="text" id="new-account-name" placeholder="V√≠ d·ª•: T√†i kho·∫£n Test API">
            </div>

            <div class="config-group half-group">
                <div class="half-item">
                    <label for="partner-id-input">Partner ID (1)</label>
                    <input type="text" id="partner-id-input" value="ECOMMERCE_GATEWAY" placeholder="ID (V√≠ d·ª•: MomoWallet)">
                </div>
                <div class="half-item">
                    <label for="account-owner">T√™n Ch·ªß TK (10)</label>
                    <input type="text" id="account-owner" value="NGUYEN VAN A" placeholder="T√™n s·∫Ω hi·ªÉn th·ªã trong tin nh·∫Øn">
                </div>
            </div>
            
            <div class="action-buttons-group">
                <button class="action-btn" style="background-color: #3f51b5;" onclick="addOrUpdateAccount()">‚ûï Th√™m / C·∫≠p Nh·∫≠t TK</button>
            </div>

            <hr class="separator">
            
            <h2>üîó C·∫•u H√¨nh Webhook/Callback</h2>
            <div class="config-group">
                <label for="webhook-url">Webhook URL</label>
                <input type="text" id="webhook-url" value="https://sandbox.partner.com/api/callback" placeholder="URL nh·∫≠n ph·∫£n h·ªìi t·ª´ Gateway">
            </div>
            
            <div class="config-group half-group">
                <div class="half-item">
                    <label for="webhook-status">Webhook Response Status</label>
                    <select id="webhook-status">
                        <option value="200">200 OK (Th√†nh c√¥ng)</option>
                        <option value="400">400 Bad Request</option>
                        <option value="500">500 Server Error</option>
                    </select>
                </div>
                 <div class="half-item">
                    <label for="webhook-delay">Webhook Delay (ms)</label>
                    <input type="number" id="webhook-delay" value="200" min="0">
                </div>
            </div>

            <div class="config-group">
                <label for="webhook-secret">Webhook Secret Key (Signature)</label>
                <input type="text" id="webhook-secret" value="secret_test_key" placeholder="Key d√πng ƒë·ªÉ t·∫°o ch·ªØ k√Ω (signature)">
            </div>
            
             <hr class="separator">
            
            <div class="action-buttons-group">
                <button class="action-btn export-btn" onclick="exportTransactions()">‚¨áÔ∏è Xu·∫•t L·ªãch S·ª≠ (CSV)</button>
                <button class="action-btn" style="background-color: var(--reset-bg);" onclick="clearAllDataAndReset()">üîÑ Reset T·∫•t C·∫£ D·ªØ Li·ªáu</button>
            </div>
        </div>

        <div class="calculator-panel">
            <h2>üí∞ Gi·∫£ L·∫≠p Giao D·ªãch</h2>
            
            <div id="current-balance-display">S·ªë d∆∞ hi·ªán t·∫°i: 0.00 VND</div>
            
            <div class="config-group">
                <label for="amount-input">S·ªë ti·ªÅn GD (VND)</label>
                <input type="text" id="amount-input" value="100.000" placeholder="0" data-original-value="100000" oninput="formatInput(this)">
            </div>
            
            <div class="config-group">
                <label for="daily-limit-input">H·∫°n m·ª©c t·ªëi ƒëa/ng√†y (VND)</label>
                <input type="text" id="daily-limit-input" value="100.000.000" placeholder="0 = Kh√¥ng gi·ªõi h·∫°n" data-original-value="100000000" oninput="formatInput(this)">
            </div>
            
            <div class="config-group">
                <label for="transfer-content">N·ªôi Dung Chuy·ªÉn Kho·∫£n (9)</label>
                <input type="text" id="transfer-content" placeholder="N·ªôi dung t√πy ch·ªânh">
            </div>
            
            <div class="config-group">
                <label for="default-content-template">M·∫´u N·ªôi Dung M·∫∑c ƒê·ªãnh (4)</label>
                <input type="text" id="default-content-template" value="Thanh toan don hang {TX_ID}" placeholder="S·ª≠ d·ª•ng {TX_ID} ƒë·ªÉ ch√®n m√£ GD">
            </div>
            
            <hr class="separator">
            
            <h2>‚è±Ô∏è C·∫•u H√¨nh Tr·∫°ng Th√°i</h2>
            
            <div class="config-group">
                <label for="transaction-type-select">Lo·∫°i Giao D·ªãch C·ªë ƒê·ªãnh (2)</label>
                <select id="transaction-type-select">
                    <option value="Payment">Thanh To√°n (Ti·ªÅn v√†o)</option>
                    <option value="Refund">Ho√†n Ti·ªÅn (Ti·ªÅn ra)</option>
                    <option value="Fee">Ph√≠/Hoa H·ªìng (Ti·ªÅn ra)</option>
                </select>
            </div>
            
            <div class="config-group half-group">
                <div class="half-item">
                    <label for="delay-input">ƒê·ªô tr·ªÖ SMS (s)</label>
                    <input type="number" id="delay-input" value="1" min="0">
                </div>
                <div class="half-item">
                    <label for="simulated-status-select">Tr·∫°ng Th√°i Gi·∫£ L·∫≠p</label>
                    <select id="simulated-status-select">
                        <option value="Success">Th√†nh C√¥ng (Success)</option>
                        <option value="Failure">Th·∫•t B·∫°i (Failure)</option>
                        <option value="Pending">ƒêang Ch·ªù (Pending)</option>
                    </select>
                </div>
            </div>
            
             <div class="config-group half-group">
                <div class="half-item">
                    <label for="error-code-input">M√£ L·ªói (E100, E999)</label>
                    <input type="text" id="error-code-input" value="E999_SYSTEM_ERROR" placeholder="M√£ l·ªói h·ªá th·ªëng">
                </div>
                <div class="half-item">
                     <label for="refund-id">Ref. ID Ho√†n Ti·ªÅn (8)</label>
                    <input type="text" id="refund-id" placeholder="M√£ GD g·ªëc n·∫øu l√† Ho√†n ti·ªÅn">
                </div>
            </div>

            <div class="config-group datetime-group">
                <div class="half-item">
                    <label for="date-input">Ng√†y GD</label>
                    <input type="date" id="date-input">
                </div>
                <div class="half-item">
                    <label for="time-input">Gi·ªù GD</label>
                    <input type="time" id="time-input" step="1">
                </div>
            </div>

            <div class="action-buttons-group">
                <button class="action-btn payment-btn" onclick="simulatePayment()">‚úÖ Thanh To√°n (Ti·ªÅn v√†o)</button>
                <button class="action-btn refund-btn" onclick="simulateRefund()">‚Ü©Ô∏è Ho√†n Ti·ªÅn (Ti·ªÅn ra)</button>
                <button class="action-btn fail-btn" onclick="simulateFee()">üíµ Ph√≠/Hoa H·ªìng (Ti·ªÅn ra)</button>
            </div>
        </div>

        <div class="history-panel">
            <h2>üìú L·ªãch S·ª≠ Giao D·ªãch</h2>
            <div id="history-container">
                <p style="color: #aaa; text-align: center; padding: 10px;">ƒêang t·∫£i...</p>
            </div>
        </div>

        <div class="message-panel">
            <h2>üí¨ Tin Nh·∫Øn Ng√¢n H√†ng Gi·∫£ L·∫≠p (Bank SMS/App Notification)</h2>
            <div class="telegram-chat">
                <div id="message-container">
                    <div class="system-message">
                        Ch√†o m·ª´ng ƒë·∫øn v·ªõi H·ªá th·ªëng gi·∫£ l·∫≠p CashBank Gateway. Vui l√≤ng nh·∫≠p th√¥ng tin c·∫•u h√¨nh v√† ti·∫øn h√†nh gi·∫£ l·∫≠p.
                    </div>
                </div>
            </div>
             <button class="action-btn clear-messages-btn" onclick="clearMessages()">üóëÔ∏è X√≥a Tin Nh·∫Øn Hi·ªÉn Th·ªã</button>
        </div>

    </div>

    <div id="transaction-detail-modal" class="modal" onclick="closeModalOnOutsideClick(event)">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>

            <div class="modal-qr-section">
                <h2 class="modal-h2">M√£ QR Gi·∫£ L·∫≠p</h2>
                <div id="qr-code-display" class="qr-code-placeholder">
                    <span>M√£ QR m√¥ ph·ªèng</span>
                </div>
                <div id="modal-qr-content">N·ªôi dung QR</div>
            </div>

            <div class="modal-details">
                <h2 class="modal-h2" id="detail-modal-title">Chi Ti·∫øt Giao D·ªãch</h2>
                <div id="modal-details-container">
                    <div class="detail-item"><span class="detail-label">M√£ Giao D·ªãch:</span> <span id="modal-tx-id" class="detail-value"></span></div>
                    <div class="detail-item"><span class="detail-label">T√†i Kho·∫£n Nh·∫≠n:</span> <span id="modal-bank-acc" class="detail-value"></span></div>
                    <div class="detail-item"><span class="detail-label">Ng√¢n H√†ng:</span> <span id="modal-bank-name" class="detail-value"></span></div>
                    <div class="detail-item"><span class="detail-label">S·ªë Ti·ªÅn:</span> <span id="modal-amount" class="detail-value"></span></div>
                    <div class="detail-item"><span class="detail-label">N·ªôi Dung:</span> <span id="modal-content" class="detail-value"></span></div>
                    <div class="detail-item"><span class="detail-label">Tr·∫°ng Th√°i:</span> <span id="modal-status" class="detail-value"></span></div>
                    <div class="detail-item"><span class="detail-label">Webhook Status:</span> <span id="modal-webhook-status" class="detail-value">N/A</span></div>
                    <div class="detail-item"><span class="detail-label">Th·ªùi Gian GD:</span> <span id="modal-time" class="detail-value"></span></div>
                </div>
            </div>
        </div>
    </div>
    
    <footer id="main-footer">
        <p>Phi√™n b·∫£n Gateway Pro - H·ªó tr·ª£ <a href="#" style="color: var(--accent-color); text-decoration: none;">Sandbox</a> | M√£ PIN m·∫∑c ƒë·ªãnh: <strong>1239</strong> | <a href="https://github.com/your-repo" target="_blank" style="color: var(--accent-color); text-decoration: none;">GitHub</a></p>
    </footer>

    <script src="js/cashbank.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4361ee">
    <title>H·ªá Th·ªëng Ch·∫•m C√¥ng Th√¥ng Minh</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
</head>
<body>
    <div id="global-loading" class="hidden">
        <div class="spinner"></div>
        <p id="loading-text">ƒêang x·ª≠ l√Ω...</p>
    </div>

    <div id="login-screen" class="screen">
        <div class="login-card">
            <div class="logo-area">
                <span class="material-icons-round">account_circle</span>
            </div>
            <h2>ƒêƒÇNG NH·∫¨P</h2>
            <div class="input-group">
                <span class="material-icons-round">person</span>
                <input type="text" id="username" placeholder="Nh·∫≠p H·ªç v√† T√™n" onkeypress="handleEnter(event)">
            </div>
            <div class="input-group">
                <span class="material-icons-round">lock</span>
                <input type="password" id="password" placeholder="M·∫≠t kh·∫©u" onkeypress="handleEnter(event)">
                <span class="material-icons-round toggle-password" onclick="togglePassword()">visibility_off</span>
            </div>
            <button onclick="login()" class="btn-login">V√ÄO H·ªÜ TH·ªêNG</button>
        </div>
    </div>

    <div id="main-screen" class="screen hidden">
        <div class="app-container">
            <div class="user-header">
                <div>
                    <p class="welcome">Ch√†o m·ª´ng tr·ªü l·∫°i,</p>
                    <h3 id="display-name">--</h3>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="date-tag" id="date-display">--/--</div>
                    <span class="material-icons-round menu-btn" onclick="toggleMenu()">menu</span>
                </div>
            </div>

            <div class="status-card">
                <div class="gps-info">
                    <span class="material-icons-round" id="gps-icon">my_location</span>
                    <span id="status-text">ƒêang ƒë·ªãnh v·ªã...</span>
                </div>
                <div class="dist-badge"><span id="dist-val">--</span>m</div>
            </div>

            <div class="action-area">
                <div class="button-wrapper">
                    <button id="check-btn" class="btn-main" onclick="openCameraModal()" disabled>
                        <span class="material-icons-round" id="btn-icon">fingerprint</span>
                        <span id="btn-label">KI·ªÇM TRA GPS</span>
                        <small id="btn-timer"></small>
                    </button>
                </div>
            </div>

            <div class="progress-section">
                <div class="progress-header">
                    <span>Ti·∫øn ƒë·ªô ng√†y c√¥ng</span>
                    <span id="progress-text">0/4 l·∫ßn</span>
                </div>
                <div class="progress-bar-bg">
                    <div id="progress-bar-fill"></div>
                </div>
            </div>

            <div class="history-section">
                <h4>L·ªãch s·ª≠ h√¥m nay</h4>
                <div id="history-list"></div>
            </div>
        </div>

        <div id="camera-modal" class="hidden">
            <div class="camera-container">
                <h3>X√°c th·ª±c khu√¥n m·∫∑t</h3>
                <video id="camera-stream" autoplay playsinline></video>
                <canvas id="camera-canvas" class="hidden"></canvas>
                <div class="camera-actions">
                    <button class="btn-cancel" onclick="closeCameraModal()">H·ªßy</button>
                    <button class="btn-capture" onclick="captureAndSubmit()">üì∏ Ch·ª•p & G·ª≠i</button>
                </div>
            </div>
        </div>

        <div id="sidebar-overlay" class="sidebar-overlay" onclick="toggleMenu()"></div>
        <div id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3>Ti·ªán √≠ch</h3>
                <span class="material-icons-round close-btn" onclick="toggleMenu()">close</span>
            </div>
            <ul class="sidebar-menu">
                <li onclick="openChangePassModal()">
                    <span class="material-icons-round">vpn_key</span> ƒê·ªïi m·∫≠t kh·∫©u
                </li>
                <li class="logout-item" onclick="logout()">
                    <span class="material-icons-round">logout</span> ƒêƒÉng xu·∫•t
                </li>
            </ul>
        </div>
    </div>

    <div id="change-pass-modal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; justify-content: center; align-items: center; padding: 20px;">
            <div style="background: #fff; padding: 25px; border-radius: 20px; width: 100%; max-width: 350px;">
                <h3 style="margin-top:0; color:#4361ee; text-align:center;">ƒê·ªïi M·∫≠t Kh·∫©u</h3>
                
                <div class="input-group">
                    <span class="material-icons-round">lock_outline</span>
                    <input type="password" id="old-pass" placeholder="M·∫≠t kh·∫©u hi·ªán t·∫°i">
                </div>
                <div class="input-group">
                    <span class="material-icons-round">lock</span>
                    <input type="password" id="new-pass" placeholder="M·∫≠t kh·∫©u m·ªõi">
                </div>
                <div class="input-group">
                    <span class="material-icons-round">check_circle</span>
                    <input type="password" id="confirm-pass" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi">
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button onclick="closeChangePassModal()" style="flex: 1; padding: 12px; border: none; border-radius: 10px; background: #7d8597; color: white; cursor: pointer;">H·ªßy</button>
                    <button onclick="submitChangePassword()" style="flex: 1; padding: 12px; border: none; border-radius: 10px; background: #4361ee; color: white; cursor: pointer; font-weight: bold;">C·∫≠p nh·∫≠t</button>
                </div>
            </div>
        </div>

    <script src="script.js"></script>
</body>
</html>